name: Deploy Shopify Theme

on:
  push:
    branches:
      - main
      - master
    paths:
      - '**'
      - '.github/workflows/deploy.yml'
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Shopify
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install Shopify CLI
        run: |
          npm install -g @shopify/cli @shopify/theme

      - name: Deploy to Shopify
        env:
          SHOPIFY_STORE: ${{ secrets.SHOPIFY_STORE }}
          SHOPIFY_PASSWORD: ${{ secrets.SHOPIFY_PASSWORD }}
        run: |
          # Deploy to specific theme ID if provided, otherwise create new unpublished theme
          if [ -n "${{ secrets.SHOPIFY_THEME_ID }}" ]; then
            echo "Deploying to theme ID: ${{ secrets.SHOPIFY_THEME_ID }}"
            shopify theme push --store="${{ secrets.SHOPIFY_STORE }}" --password="${{ secrets.SHOPIFY_PASSWORD }}" --theme="${{ secrets.SHOPIFY_THEME_ID }}" --allow-live
          else
            echo "Deploying as new unpublished theme"
            shopify theme push --store="${{ secrets.SHOPIFY_STORE }}" --password="${{ secrets.SHOPIFY_PASSWORD }}" --unpublished --theme="SXRX Auto-Deployed $(date +%Y%m%d-%H%M%S)"
          fi

      - name: Deployment Summary
        if: always()
        run: |
          echo "## ðŸŽ¨ Shopify Theme Deployment" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Theme deployment completed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Store:** ${{ secrets.SHOPIFY_STORE }}" >> $GITHUB_STEP_SUMMARY
          echo "**Theme ID:** ${{ secrets.SHOPIFY_THEME_ID || 'New unpublished theme' }}" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY

